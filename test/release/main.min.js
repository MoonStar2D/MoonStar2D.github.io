var __reflect=this&&this.__reflect||function(t,a,e){t.__class__=a,e?e.push(a):e=[a],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,a){function e(){this.constructor=t}for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i]);t.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)},LoadingUI=function(t){function a(){var a=t.call(this)||this;return a.createView(),a}return __extends(a,t),a.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},a.prototype.setProgress=function(t,a){this.textField.text="Loading..."+t+"/"+a},a}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function a(){var a=t.call(this)||this;return a.armaInintX=0,a.armaInintY=0,a.hasStage=!1,a.curAnimIndex=0,a.tempX=0,a.tempY=0,a.armeX=0,a.armeY=0,a.armeSX=0,a.isMove=!1,a.isCtrlDown=!1,a.firstPoint=-1,a.secondPoint=-1,a.temp2X=0,a.temp2Y=0,a.isMultiFinger=!1,a.tempDisX=0,a.tempDisY=0,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a}return __extends(a,t),a.prototype.onAddToStage=function(t){this.stage.dirtyRegionPolicy=egret.DirtyRegionPolicy.OFF,this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},a.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("TestArmature")},a.prototype.onResourceLoadComplete=function(t){"TestArmature"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},a.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},a.prototype.onResourceProgress=function(t){"TestArmature"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},a.prototype.createGameScene=function(){var t=this;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),document.addEventListener("keydown",function(a){if(17==a.keyCode&&(t.isCtrlDown=!0),49==a.keyCode){if(t.hasStage)t.container.x=0,t.container.y=0,t.container.scaleX=1,t.container.scaleY=1,t.armatureDisplay.x=t.armature.getBones()[0].global.x,t.armatureDisplay.y=t.armature.getBones()[0].global.y;else if(t.hasStage=!1,0==t.armature.armatureData.aabb.width&&0==t.armature.armatureData.aabb.height&&0==t.armature.armatureData.aabb.x&&0==t.armature.armatureData.aabb.y)t.armatureDisplay.x=t.armature.getBones()[0].global.x+600,t.armatureDisplay.y=t.armature.getBones()[0].global.y+450;else{var e=t.armature.armatureData.aabb.width/1100;t.armature.armatureData.aabb.height/800>e&&(e=t.armature.armatureData.aabb.height/800),e>3&&(e=3),.3>e&&(e=.3);var i=(1100-t.armature.armatureData.aabb.width/e)/2,r=(800-t.armature.armatureData.aabb.height/e)/2;t.armatureDisplay.x=-t.armature.armatureData.aabb.x/e+i+50,t.armatureDisplay.y=-t.armature.armatureData.aabb.y/e+r+50,t.armatureDisplay.scaleX=1/e,t.armatureDisplay.scaleY=1/e}t.tempDisX=0,t.tempDisY=0}}),document.addEventListener("keyup",function(a){17==a.keyCode&&(t.isCtrlDown=!1)}),this.createMotorcycleExp()},a.prototype.createMotorcycleExp=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container);var t=RES.getRes("skeleton_json"),a=RES.getRes("texture_json"),e=RES.getRes("texture_png"),i=new dragonBones.EgretFactory;i.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(t)),RES.hasRes("texture_png")&&(a=RES.getRes("texture_json"),e=RES.getRes("texture_png"),i.addTextureAtlas(new dragonBones.EgretTextureAtlas(e,a)));for(var r=0;RES.hasRes("texture_png"+r);)a=RES.getRes("texture_json"+r),e=RES.getRes("texture_png"+r),i.addTextureAtlas(new dragonBones.EgretTextureAtlas(e,a)),r++;if(this.armature=i.buildArmature(t.armature[0].name),this.armatureDisplay=this.armature.display,dragonBones.WorldClock.clock.add(this.armature),this.container.addChild(this.armatureDisplay),"Stage"==t.armature[0].type)this.hasStage=!0,this.container.x=0,this.container.y=0,this.container.scaleX=1,this.container.scaleY=1,this.armatureDisplay.x=this.armature.getBones()[0].global.x,this.armatureDisplay.y=this.armature.getBones()[0].global.y;else if(this.hasStage=!1,0==this.armature.armatureData.aabb.width&&0==this.armature.armatureData.aabb.height&&0==this.armature.armatureData.aabb.x&&0==this.armature.armatureData.aabb.y)this.armatureDisplay.x=this.armature.getBones()[0].global.x+600,this.armatureDisplay.y=this.armature.getBones()[0].global.y+450;else{var s=this.armature.armatureData.aabb.width/1100;this.armature.armatureData.aabb.height/800>s&&(s=this.armature.armatureData.aabb.height/800),s>3&&(s=3),.3>s&&(s=.3);var n=(1100-this.armature.armatureData.aabb.width/s)/2,o=(800-this.armature.armatureData.aabb.height/s)/2;this.armatureDisplay.x=-this.armature.armatureData.aabb.x/s+n+50,this.armatureDisplay.y=-this.armature.armatureData.aabb.y/s+o+50,this.armatureDisplay.scaleX=1/s,this.armatureDisplay.scaleY=1/s}this.armaInintX=this.armatureDisplay.x,this.armaInintY=this.armatureDisplay.y,this.armature.animation.play(this.armature.animation.animationList[0]),egret.startTick(function(t){return dragonBones.WorldClock.clock.advanceTime(-1),!1},this)},a.prototype.onTouch=function(t){this.curAnimIndex++,this.curAnimationName=this.armature.animation.animationList[this.curAnimIndex%this.armature.animation.animationList.length],this.armature.animation.play(this.curAnimationName)},a.prototype.onTouchBegin=function(t){-1==this.firstPoint?(this.firstPoint=t.touchPointID,this.tempX=t.stageX,this.tempY=t.stageY,this.armeX=this.armatureDisplay.x,this.armeY=this.armatureDisplay.y,this.armeSX=this.armatureDisplay.scaleX,this.nowX=t.stageX,this.nowY=t.stageY):-1==this.secondPoint&&(this.secondPoint=t.touchPointID,this.isMultiFinger=!0,this.temp2X=t.stageX,this.temp2Y=t.stageY,this.now2X=t.stageX,this.now2Y=t.stageY)},a.prototype.onTouchMove=function(t){if(this.isMove=!0,t.touchPointID==this.firstPoint&&(this.nowX=t.stageX,this.nowY=t.stageY),t.touchPointID==this.secondPoint&&(this.now2X=t.stageX,this.now2Y=t.stageY),this.isMultiFinger){var a=Math.sqrt((this.now2X-this.nowX)*(this.now2X-this.nowX)+(this.now2Y-this.nowY)*(this.now2Y-this.nowY)),e=Math.sqrt((this.temp2X-this.tempX)*(this.temp2X-this.tempX)+(this.temp2Y-this.tempY)*(this.temp2Y-this.tempY)),i=a/e-1;i>0?this.armatureDisplay.scaleX<=3&&this.armeSX+i<=3&&(this.armatureDisplay.scaleX=this.armeSX+i,this.armatureDisplay.scaleY=this.armeSX+i):this.armatureDisplay.scaleX>=.3&&this.armeSX+i>=.3&&(this.armatureDisplay.scaleX=this.armeSX+i,this.armatureDisplay.scaleY=this.armeSX+i);var r=1/this.armatureDisplay.scaleX,s=(1100-this.armature.armatureData.aabb.width/r)/2,n=(800-this.armature.armatureData.aabb.height/r)/2;this.armatureDisplay.x=-this.armature.armatureData.aabb.x/r+s+50+this.tempDisX,this.armatureDisplay.y=-this.armature.armatureData.aabb.y/r+n+50+this.tempDisY}else{var o=t.stageY-this.tempY;if(this.isCtrlDown){this.tempY<t.stageY?this.armatureDisplay.scaleX>.3&&this.armeSX-o/200>.3?(this.armatureDisplay.scaleX=this.armeSX-o/200,this.armatureDisplay.scaleY=this.armeSX-o/200):(this.armatureDisplay.scaleX=.3,this.armatureDisplay.scaleY=.3):this.armatureDisplay.scaleX<3&&this.armeSX-o/200<3?(this.armatureDisplay.scaleX=this.armeSX-o/200,this.armatureDisplay.scaleY=this.armeSX-o/200):(this.armatureDisplay.scaleX=3,this.armatureDisplay.scaleY=3);var r=1/this.armatureDisplay.scaleX,s=(1100-this.armature.armatureData.aabb.width/r)/2,n=(800-this.armature.armatureData.aabb.height/r)/2;this.armatureDisplay.x=-this.armature.armatureData.aabb.x/r+s+50+this.tempDisX,this.armatureDisplay.y=-this.armature.armatureData.aabb.y/r+n+50+this.tempDisY}else this.armatureDisplay.x=this.armeX+(t.stageX-this.tempX),this.armatureDisplay.y=this.armeY+(t.stageY-this.tempY),this.tempDisX=this.armatureDisplay.x-this.armaInintX,this.tempDisY=this.armatureDisplay.y-this.armaInintY}},a.prototype.onTouchEnd=function(t){this.firstPoint==t.touchPointID&&(this.firstPoint=-1),this.secondPoint==t.touchPointID&&(this.secondPoint=-1),-1==this.firstPoint&&-1==this.secondPoint&&(this.isMultiFinger=!1),this.isMultiFinger||(this.isMove?this.isMove=!1:(this.curAnimIndex++,this.curAnimationName=this.armature.animation.animationList[this.curAnimIndex%this.armature.animation.animationList.length],this.armature.animation.play(this.curAnimationName)))},a}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");